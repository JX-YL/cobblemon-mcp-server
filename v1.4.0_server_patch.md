# v1.4.0 Server.py 修改说明

## 需要修改的函数

### 1. create_pokemon_with_stats() - 新增参数

在现有参数后添加 v1.4.0 新参数：

```python
@mcp.tool()
async def create_pokemon_with_stats(
    name: str,
    dex: int,
    primary_type: str,
    # 种族值
    hp: int = 100,
    attack: int = 100,
    defence: int = 100,
    special_attack: int = 100,
    special_defence: int = 100,
    speed: int = 100,
    
    # v1.4.0 新增：双属性
    secondary_type: str = None,
    
    # v1.4.0 新增：自定义特性
    abilities: list = None,
    
    # v1.4.0 新增：性别比例
    male_ratio: float = 0.5,
    
    # v1.4.0 新增：体型（注意单位）
    height: int = 10,        # 分米（dm）
    weight: int = 100,       # 百克（hg = kg*10）
    base_scale: float = 1.0,
    
    # v1.4.0 新增：捕获与繁殖
    catch_rate: int = 45,
    base_friendship: int = 50,
    egg_cycles: int = 20,
    
    # v1.4.0 新增：努力值产出
    ev_hp: int = 0,
    ev_attack: int = 0,
    ev_defence: int = 0,
    ev_special_attack: int = 0,
    ev_special_defence: int = 0,
    ev_speed: int = 0,
    
    # 招式与进化（v1.3.0）
    moves: list = None,
    evolution_level: int = None,
    evolution_target: str = None,
    evolution_variant: str = "level_up",
    evolution_item: str = None,
    evolution_friendship: int = None,
    evolution_time_range: str = None,
    evolution_move_type: str = None
) -> dict:
```

### 2. create_pokemon_with_stats() - 生成逻辑

将现有的 `species` 生成代码替换为：

```python
    # 使用官方格式生成配置
    species = {
        # 1. 基础信息（必需）
        "implemented": True,
        "nationalPokedexNumber": dex,
        "name": name,
        "primaryType": primary_type.lower(),
        
        # 2. 性别和体型（必需）
        "maleRatio": male_ratio,
        "height": height,  # 整数（分米）
        "weight": weight,  # 整数（百克）
        
        # 3. 图鉴和标签（必需）
        "pokedex": [f"cobblemon.species.{name.lower()}.desc"],
        "labels": ["custom"],
        "aspects": [],
        
        # 4. 特性（必需）
        "abilities": abilities if abilities else ["synchronize"],
        
        # 5. 蛋组（必需）
        "eggGroups": ["undiscovered"],
        
        # 6. 能力值（必需）
        "baseStats": {
            "hp": hp,
            "attack": attack,
            "defence": defence,
            "special_attack": special_attack,
            "special_defence": special_defence,
            "speed": speed
        },
        
        # 7. 努力值产出（必需）
        "evYield": {
            "hp": ev_hp,
            "attack": ev_attack,
            "defence": ev_defence,
            "special_attack": ev_special_attack,
            "special_defence": ev_special_defence,
            "speed": ev_speed
        },
        
        # 8. 经验值系统（必需）
        "baseExperienceYield": 64,
        "experienceGroup": "medium_slow",
        
        # 9. 捕获和繁殖（必需）
        "catchRate": catch_rate,
        "eggCycles": egg_cycles,
        "baseFriendship": base_friendship,
        
        # 10. 实体属性（必需）
        "baseScale": base_scale,
        "hitbox": {
            "width": 0.9,
            "height": 1.0,
            "fixed": False
        },
        
        # 11. 掉落物（必需）
        "drops": {
            "amount": 1,
            "entries": []
        }
    }
    
    # 添加副属性（可选）
    if secondary_type:
        species["secondaryType"] = secondary_type.lower()
```

### 3. create_complete_package() - 更新参数

将签名更新为：

```python
@mcp.tool()
async def create_complete_package(
    name: str,
    dex: int,
    primary_type: str,
    hp: int = 100,
    attack: int = 100,
    defence: int = 100,
    special_attack: int = 100,
    special_defence: int = 100,
    speed: int = 100,
    
    # v1.4.0 新增
    secondary_type: str = None,
    abilities: list = None,
    male_ratio: float = 0.5,
    height: int = 10,
    weight: int = 100,
    base_scale: float = 1.0,
    catch_rate: int = 45,
    base_friendship: int = 50,
    egg_cycles: int = 20,
    ev_hp: int = 0,
    ev_attack: int = 0,
    ev_defence: int = 0,
    ev_special_attack: int = 0,
    ev_special_defence: int = 0,
    ev_speed: int = 0,
    
    # 招式与进化
    moves: list = None,
    evolution_level: int = None,
    evolution_target: str = None,
    evolution_variant: str = "level_up",
    evolution_item: str = None,
    evolution_friendship: int = None,
    evolution_time_range: str = None,
    evolution_move_type: str = None
) -> dict:
```

并更新调用：

```python
    result = await create_pokemon_with_stats(
        name, dex, primary_type,
        hp, attack, defence,
        special_attack, special_defence, speed,
        secondary_type, abilities, male_ratio,
        height, weight, base_scale,
        catch_rate, base_friendship, egg_cycles,
        ev_hp, ev_attack, ev_defence,
        ev_special_attack, ev_special_defence, ev_speed,
        moves, evolution_level, evolution_target,
        evolution_variant, evolution_item,
        evolution_friendship, evolution_time_range, evolution_move_type
    )
```

## 关键注意事项

1. **单位转换**：
   - `height`: 米 → 分米（乘以 10）
   - `weight`: 千克 → 百克（乘以 10）

2. **数据类型**：
   - `height`, `weight`: **必须是整数**
   - `maleRatio`: 浮点数，-1 表示无性别

3. **字段顺序**：按官方顺序排列（虽然可能不强制，但保持一致性）

4. **必需字段**：确保所有字段都存在，不要遗漏

---

由于修改量大，建议直接创建新版本文件而不是逐行修改。

